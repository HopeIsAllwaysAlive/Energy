<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Energy Clicker</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    .animate-bounce { animation: bounce 1s ease-in-out; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function EnergyClicker() {
      const defaultGenerators = [
        { id: 1, name: 'Solar Panel', baseCost: 10, cost: 10, owned: 0, production: 1, visible: true, unlockRequirement: 0, milestones: [
          { amount: 10, multiplier: 2 },
          { amount: 25, multiplier: 2 },
          { amount: 50, multiplier: 3 }
        ]},
        { id: 2, name: 'Wind Turbine', baseCost: 100, cost: 100, owned: 0, production: 5, visible: false, unlockRequirement: 5, milestones: [
          { amount: 10, multiplier: 2 },
          { amount: 25, multiplier: 2 },
          { amount: 50, multiplier: 3 }
        ]},
        { id: 3, name: 'Power Plant', baseCost: 1000, cost: 1000, owned: 0, production: 25, visible: false, unlockRequirement: 5, milestones: [
          { amount: 10, multiplier: 2 },
          { amount: 25, multiplier: 2 },
          { amount: 50, multiplier: 3 }
        ]},
        { id: 4, name: 'Fusion Reactor', baseCost: 10000, cost: 10000, owned: 0, production: 100, visible: false, unlockRequirement: 5, milestones: [
          { amount: 10, multiplier: 2 },
          { amount: 25, multiplier: 2 },
          { amount: 50, multiplier: 4 }
        ]},
        { id: 5, name: 'Antimatter Generator', baseCost: 100000, cost: 100000, owned: 0, production: 500, visible: false, unlockRequirement: 5, milestones: [
          { amount: 10, multiplier: 2 },
          { amount: 25, multiplier: 3 },
          { amount: 50, multiplier: 5 }
        ]}
      ];

      const defaultUpgrades = [
        { id: 1, name: 'Better Clicking', cost: 50, purchased: false, multiplier: 2, type: 'click', visible: true, requirement: { energy: 40 } },
        { id: 2, name: 'Efficient Panels', cost: 500, purchased: false, multiplier: 2, type: 'production', visible: false, requirement: { generators: [{ id: 1, amount: 5 }] } },
        { id: 3, name: 'Mega Click', cost: 5000, purchased: false, multiplier: 5, type: 'click', visible: false, requirement: { energy: 4000 } },
        { id: 4, name: 'Turbine Boost', cost: 10000, purchased: false, multiplier: 2, type: 'production', visible: false, requirement: { generators: [{ id: 2, amount: 10 }] } },
        { id: 5, name: 'Ultra Click', cost: 50000, purchased: false, multiplier: 10, type: 'click', visible: false, requirement: { energy: 40000 } }
      ];

      const defaultAchievements = [
        { id: 1, name: 'First Click', desc: 'Klik 1 keer', requirement: 1, type: 'clicks', unlocked: false, reward: { type: 'clickMultiplier', value: 1.1 } },
        { id: 2, name: 'Clicker', desc: 'Klik 100 keer', requirement: 100, type: 'clicks', unlocked: false, reward: { type: 'clickMultiplier', value: 1.25 } },
        { id: 3, name: 'Click Master', desc: 'Klik 1000 keer', requirement: 1000, type: 'clicks', unlocked: false, reward: { type: 'clickMultiplier', value: 1.5 } },
        { id: 4, name: 'Rich', desc: 'Verzamel 1000 energy', requirement: 1000, type: 'energy', unlocked: false, reward: { type: 'productionMultiplier', value: 1.1 } },
        { id: 5, name: 'Tycoon', desc: 'Verzamel 10000 energy', requirement: 10000, type: 'energy', unlocked: false, reward: { type: 'productionMultiplier', value: 1.25 } },
        { id: 6, name: 'Mogul', desc: 'Verzamel 100000 energy', requirement: 100000, type: 'energy', unlocked: false, reward: { type: 'productionMultiplier', value: 1.5 } },
        { id: 7, name: 'Automation Expert', desc: 'Klik 5000 keer', requirement: 5000, type: 'clicks', unlocked: false, reward: { type: 'unlockAutobuyers', value: 'generators' } },
        { id: 8, name: 'Efficiency Master', desc: 'Verzamel 1M energy', requirement: 1000000, type: 'energy', unlocked: false, reward: { type: 'unlockAutobuyers', value: 'upgrades' } }
      ];

      const loadGame = () => {
        try {
          const saved = localStorage.getItem('energyClickerSave');
          if (saved) {
            const data = JSON.parse(saved);
            return data;
          }
        } catch (e) {
          console.error('Error loading save:', e);
        }
        return null;
      };

      const savedData = loadGame();

      const [energy, setEnergy] = useState(savedData?.energy || 0);
      const [totalEnergy, setTotalEnergy] = useState(savedData?.totalEnergy || 0);
      const [energyPerSecond, setEnergyPerSecond] = useState(0);
      const [clickPower, setClickPower] = useState(savedData?.clickPower || 1);
      const [prestigeLevel, setPrestigeLevel] = useState(savedData?.prestigeLevel || 0);
      const [prestigeBonus, setPrestigeBonus] = useState(savedData?.prestigeBonus || 1);
      const [lastSaveTime, setLastSaveTime] = useState(savedData?.lastSaveTime || Date.now());
      
      const [generators, setGenerators] = useState(savedData?.generators || defaultGenerators);
      const [upgrades, setUpgrades] = useState(savedData?.upgrades || defaultUpgrades);
      const [totalClicks, setTotalClicks] = useState(savedData?.totalClicks || 0);
      const [lifetimeClicks, setLifetimeClicks] = useState(savedData?.lifetimeClicks || 0);
      const [achievements, setAchievements] = useState(savedData?.achievements || defaultAchievements);
      const [showAchievement, setShowAchievement] = useState(null);
      const [buyAmount, setBuyAmount] = useState(1);
      const [activeTab, setActiveTab] = useState('main');
      const [prestigePoints, setPrestigePoints] = useState(savedData?.prestigePoints || 0);
      const [autoBuyersEnabled, setAutoBuyersEnabled] = useState(savedData?.autoBuyersEnabled || {
        generators: false,
        upgrades: false
      });
      const [autoBuyersUnlocked, setAutoBuyersUnlocked] = useState(savedData?.autoBuyersUnlocked || {
        generators: false,
        upgrades: false
      });
      const [prestigeUpgrades, setPrestigeUpgrades] = useState(savedData?.prestigeUpgrades || [
        { id: 1, name: 'Click Boost I', cost: 1, purchased: false, effect: { type: 'clickMultiplier', value: 2 } },
        { id: 2, name: 'Production Boost I', cost: 1, purchased: false, effect: { type: 'productionMultiplier', value: 2 } },
        { id: 3, name: 'Click Boost II', cost: 3, purchased: false, effect: { type: 'clickMultiplier', value: 3 } },
        { id: 4, name: 'Production Boost II', cost: 3, purchased: false, effect: { type: 'productionMultiplier', value: 3 } },
        { id: 5, name: 'Offline Production', cost: 5, purchased: false, effect: { type: 'offlineRate', value: 0.5 } },
        { id: 6, name: 'Auto Clicker', cost: 10, purchased: false, effect: { type: 'autoClick', value: 1 } },
        { id: 7, name: 'Mega Click III', cost: 15, purchased: false, effect: { type: 'clickMultiplier', value: 5 } },
        { id: 8, name: 'Mega Production III', cost: 15, purchased: false, effect: { type: 'productionMultiplier', value: 5 } }
      ]);

      // Calculate achievement bonuses safely
      const achievementClickBonus = React.useMemo(() => {
        if (!achievements || !Array.isArray(achievements)) return 1;
        return achievements
          .filter(a => a && a.unlocked && a.reward && a.reward.type === 'clickMultiplier')
          .reduce((total, a) => total * a.reward.value, 1);
      }, [achievements]);

      const achievementProductionBonus = React.useMemo(() => {
        if (!achievements || !Array.isArray(achievements)) return 1;
        return achievements
          .filter(a => a && a.unlocked && a.reward && a.reward.type === 'productionMultiplier')
          .reduce((total, a) => total * a.reward.value, 1);
      }, [achievements]);

      // Calculate prestige upgrade bonuses
      const prestigeClickBonus = React.useMemo(() => {
        if (!prestigeUpgrades || !Array.isArray(prestigeUpgrades)) return 1;
        return prestigeUpgrades
          .filter(u => u && u.purchased && u.effect.type === 'clickMultiplier')
          .reduce((total, u) => total * u.effect.value, 1);
      }, [prestigeUpgrades]);

      const prestigeProductionBonus = React.useMemo(() => {
        if (!prestigeUpgrades || !Array.isArray(prestigeUpgrades)) return 1;
        return prestigeUpgrades
          .filter(u => u && u.purchased && u.effect.type === 'productionMultiplier')
          .reduce((total, u) => total * u.effect.value, 1);
      }, [prestigeUpgrades]);

      const offlineProductionRate = React.useMemo(() => {
        if (!prestigeUpgrades || !Array.isArray(prestigeUpgrades)) return 0;
        const upgrade = prestigeUpgrades.find(u => u && u.purchased && u.effect.type === 'offlineRate');
        return upgrade ? upgrade.effect.value : 0;
      }, [prestigeUpgrades]);

      const autoClickRate = React.useMemo(() => {
        if (!prestigeUpgrades || !Array.isArray(prestigeUpgrades)) return 0;
        const upgrade = prestigeUpgrades.find(u => u && u.purchased && u.effect.type === 'autoClick');
        return upgrade ? upgrade.effect.value : 0;
      }, [prestigeUpgrades]);

      // Offline progress
      useEffect(() => {
        if (savedData && energyPerSecond > 0 && lastSaveTime) {
          const now = Date.now();
          const timePassed = (now - lastSaveTime) / 1000;
          const offlineGains = Math.floor(energyPerSecond * timePassed * (offlineProductionRate || 0));
          
          if (offlineGains > 0 && timePassed > 60) {
            setEnergy(prev => prev + offlineGains);
            setTotalEnergy(prev => prev + offlineGains);
            alert(`Welkom terug! Je hebt ${offlineGains} ‚ö° verdiend terwijl je weg was (${Math.floor(timePassed / 60)} minuten)\n${offlineProductionRate > 0 ? `Offline rate: ${(offlineProductionRate * 100).toFixed(0)}%` : 'Upgrade offline production in Prestige tab!'}`);
          }
        }
      }, []);

      // Save game
      useEffect(() => {
        try {
          const saveData = {
            energy,
            totalEnergy,
            clickPower,
            generators,
            upgrades,
            totalClicks,
            lifetimeClicks,
            achievements,
            prestigeLevel,
            prestigeBonus,
            prestigePoints,
            prestigeUpgrades,
            autoBuyersEnabled,
            autoBuyersUnlocked,
            lastSaveTime: Date.now()
          };
          localStorage.setItem('energyClickerSave', JSON.stringify(saveData));
        } catch (e) {
          console.error('Error saving:', e);
        }
      }, [energy, totalEnergy, clickPower, generators, upgrades, totalClicks, lifetimeClicks, achievements, prestigeLevel, prestigeBonus, prestigePoints, prestigeUpgrades, autoBuyersEnabled, autoBuyersUnlocked]);

      // Idle production
      useEffect(() => {
        const interval = setInterval(() => {
          if (energyPerSecond > 0) {
            setEnergy(prev => prev + energyPerSecond);
            setTotalEnergy(prev => prev + energyPerSecond);
          }
          // Auto clicker
          if (autoClickRate > 0) {
            const totalClickPower = Math.floor(clickPower * achievementClickBonus * prestigeBonus * prestigeClickBonus);
            setEnergy(prev => prev + totalClickPower * autoClickRate);
            setTotalEnergy(prev => prev + totalClickPower * autoClickRate);
            setTotalClicks(prev => prev + autoClickRate);
            setLifetimeClicks(prev => prev + autoClickRate);
          }
        }, 1000);
        return () => clearInterval(interval);
      }, [energyPerSecond, autoClickRate, clickPower, achievementClickBonus, prestigeBonus, prestigeClickBonus]);

      // Check achievements
      useEffect(() => {
        if (!achievements || !Array.isArray(achievements) || achievements.length === 0) return;
        
        achievements.forEach(ach => {
          if (!ach || ach.unlocked) return;
          
          let achieved = false;
          if (ach.type === 'clicks') {
            achieved = lifetimeClicks >= ach.requirement;
          } else if (ach.type === 'energy') {
            achieved = totalEnergy >= ach.requirement;
          }
          
          if (achieved) {
            setAchievements(prev => prev.map(a =>
              a.id === ach.id ? { ...a, unlocked: true } : a
            ));
            setShowAchievement(ach);
            setTimeout(() => setShowAchievement(null), 3000);
            playSound('achievement');
            
            // Unlock autobuyers
            if (ach.reward.type === 'unlockAutobuyers') {
              setAutoBuyersUnlocked(prev => ({
                ...prev,
                [ach.reward.value]: true
              }));
            }
          }
        });
      }, [lifetimeClicks, totalEnergy]);

      // Calculate production
      useEffect(() => {
        if (!generators || !Array.isArray(generators)) return;
        
        const total = generators.reduce((sum, gen) => {
          if (!gen || !gen.milestones) return sum;
          
          let production = gen.production || 0;
          
          gen.milestones.forEach(milestone => {
            if (gen.owned >= milestone.amount) {
              production *= milestone.multiplier;
            }
          });
          
          return sum + (gen.owned * production);
        }, 0);
        
        setEnergyPerSecond(Math.floor(total * achievementProductionBonus * prestigeBonus * prestigeProductionBonus));
      }, [generators, achievementProductionBonus, prestigeBonus, prestigeProductionBonus]);

      // Check generator visibility
      useEffect(() => {
        if (!generators || !Array.isArray(generators)) return;
        
        setGenerators(prev => prev.map((gen, index) => {
          if (!gen || gen.visible) return gen;
          
          if (index > 0) {
            const prevGen = prev[index - 1];
            if (prevGen && prevGen.owned >= (gen.unlockRequirement || 0)) {
              return { ...gen, visible: true };
            }
          }
          return gen;
        }));
      }, [generators]);

      // Autobuyers
      useEffect(() => {
        if (!autoBuyersEnabled.generators && !autoBuyersEnabled.upgrades) return;
        
        const interval = setInterval(() => {
          // Auto-buy generators
          if (autoBuyersEnabled.generators && generators) {
            generators.forEach(gen => {
              if (gen.visible) {
                const cost = calculateCost(gen, 1);
                if (energy >= cost) {
                  buyGenerator(gen);
                }
              }
            });
          }
          
          // Auto-buy upgrades
          if (autoBuyersEnabled.upgrades && upgrades) {
            upgrades.forEach(upg => {
              if (upg.visible && !upg.purchased && energy >= upg.cost) {
                buyUpgrade(upg);
              }
            });
          }
        }, 100); // Check every 100ms
        
        return () => clearInterval(interval);
      }, [autoBuyersEnabled, generators, upgrades, energy]);
      useEffect(() => {
        if (!upgrades || !Array.isArray(upgrades)) return;
        
        setUpgrades(prev => prev.map(upg => {
          if (!upg || upg.visible) return upg;
          
          if (upg.requirement && upg.requirement.energy && totalEnergy >= upg.requirement.energy) {
            return { ...upg, visible: true };
          }
          
          if (upg.requirement && upg.requirement.generators && Array.isArray(upg.requirement.generators)) {
            const meetsRequirement = upg.requirement.generators.every(req => {
              const gen = generators.find(g => g && g.id === req.id);
              return gen && gen.owned >= req.amount;
            });
            if (meetsRequirement) {
              return { ...upg, visible: true };
            }
          }
          
          return upg;
        }));
      }, [totalEnergy, generators]);

      const playSound = (type) => {
        try {
          const audioContext = new (window.AudioContext || window.webkitAudioContext)();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();
          
          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);
          
          if (type === 'click') {
            oscillator.frequency.value = 800;
            gainNode.gain.value = 0.1;
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.05);
          } else if (type === 'buy') {
            oscillator.frequency.value = 600;
            gainNode.gain.value = 0.15;
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.1);
          } else if (type === 'achievement') {
            oscillator.frequency.value = 1000;
            gainNode.gain.value = 0.2;
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.2);
          }
        } catch (e) {
          console.log('Audio not supported');
        }
      };

      const handleClick = () => {
        const totalClickPower = Math.floor(clickPower * achievementClickBonus * prestigeBonus * prestigeClickBonus);
        setEnergy(prev => prev + totalClickPower);
        setTotalEnergy(prev => prev + totalClickPower);
        setTotalClicks(prev => prev + 1);
        setLifetimeClicks(prev => prev + 1);
        playSound('click');
      };

      const calculateCost = (gen, amount) => {
        if (!gen || !gen.baseCost || typeof gen.owned !== 'number') return 0;
        let total = 0;
        for (let i = 0; i < amount; i++) {
          total += Math.floor(gen.baseCost * Math.pow(1.15, gen.owned + i));
        }
        return total;
      };

      const getMaxAffordable = (gen) => {
        if (!gen) return 0;
        let amount = 0;
        let totalCost = 0;
        while (totalCost + Math.floor(gen.baseCost * Math.pow(1.15, gen.owned + amount)) <= energy) {
          totalCost += Math.floor(gen.baseCost * Math.pow(1.15, gen.owned + amount));
          amount++;
          if (amount > 1000) break;
        }
        return amount;
      };

      const buyGenerator = (gen) => {
        if (!gen) return;
        
        let amount;
        if (buyAmount === 'max') {
          amount = getMaxAffordable(gen);
        } else if (buyAmount === 'milestone') {
          amount = getToNextMilestone(gen);
        } else {
          amount = buyAmount;
        }
        
        const cost = calculateCost(gen, amount);
        
        if (energy >= cost && amount > 0) {
          setEnergy(prev => prev - cost);
          setGenerators(prev => prev.map(g => 
            g.id === gen.id 
              ? { ...g, owned: g.owned + amount, cost: Math.floor(g.baseCost * Math.pow(1.15, g.owned + amount)) }
              : g
          ));
          playSound('buy');
        }
      };

      const getToNextMilestone = (gen) => {
        if (!gen || !gen.milestones) return 0;
        const nextMilestone = gen.milestones.find(m => gen.owned < m.amount);
        if (!nextMilestone) return 0;
        return nextMilestone.amount - gen.owned;
      };

      const buyUpgrade = (upgrade) => {
        if (!upgrade || upgrade.purchased) return;
        if (energy >= upgrade.cost) {
          setEnergy(prev => prev - upgrade.cost);
          setUpgrades(prev => prev.map(u =>
            u.id === upgrade.id ? { ...u, purchased: true } : u
          ));
          
          if (upgrade.type === 'click') {
            setClickPower(prev => prev * upgrade.multiplier);
          } else if (upgrade.type === 'production') {
            setGenerators(prev => prev.map(g =>
              g.id === 1 ? { ...g, production: g.production * upgrade.multiplier } : g
            ));
          }
          playSound('buy');
        }
      };

      const getPrestigeCost = () => {
        // Cost increases: 1M, 2.5M, 5M, 10M, 20M, etc.
        return 1000000 * Math.pow(2, prestigeLevel);
      };
      
      const canPrestige = totalEnergy >= getPrestigeCost();
      
      const calculatePrestigePoints = () => {
        // Formula: sqrt(totalEnergy / 1000000) rounded down
        return Math.floor(Math.sqrt(totalEnergy / 1000000));
      };
      
      const doPrestige = () => {
        if (!canPrestige) return;
        
        const pointsGained = calculatePrestigePoints();
        
        if (confirm(`Prestige reset alles, maar geeft je:\n‚Ä¢ +50% permanent productie bonus\n‚Ä¢ ${pointsGained} Prestige Points\n\nHuidige bonus: ${((prestigeBonus - 1) * 100).toFixed(0)}%\nNieuwe bonus: ${((prestigeBonus * 1.5 - 1) * 100).toFixed(0)}%\n\nAchievements blijven behouden!\n\nDoorgaan?`)) {
          setPrestigeLevel(prev => prev + 1);
          setPrestigeBonus(prev => prev * 1.5);
          setPrestigePoints(prev => prev + pointsGained);
          
          setEnergy(0);
          setTotalEnergy(0);
          setClickPower(1);
          setTotalClicks(0);
          setEnergyPerSecond(0);
          
          setGenerators(defaultGenerators);
          setUpgrades(defaultUpgrades);
          // DON'T reset achievements anymore!
          
          // Unlock prestige tab after first prestige
          if (prestigeLevel === 0) {
            setActiveTab('prestige');
          }
        }
      };

      const resetGame = () => {
        if (confirm('Weet je zeker dat je ALLES wilt resetten? (inclusief prestige)\n\nDit kan NIET ongedaan worden gemaakt!')) {
          try {
            localStorage.removeItem('energyClickerSave');
            // Force complete reset by reloading
            setTimeout(() => {
              window.location.reload();
            }, 100);
          } catch (e) {
            console.error('Reset failed:', e);
            alert('Reset mislukt. Probeer de pagina handmatig te verversen.');
          }
        }
      };

      const buyPrestigeUpgrade = (upgrade) => {
        if (!upgrade || upgrade.purchased) return;
        if (prestigePoints >= upgrade.cost) {
          setPrestigePoints(prev => prev - upgrade.cost);
          setPrestigeUpgrades(prev => prev.map(u =>
            u.id === upgrade.id ? { ...u, purchased: true } : u
          ));
          playSound('buy');
        }
      };

      const getMilestoneProgress = (gen) => {
        if (!gen || !gen.milestones) return null;
        const nextMilestone = gen.milestones.find(m => gen.owned < m.amount);
        if (!nextMilestone) return null;
        return { next: nextMilestone.amount, current: gen.owned };
      };

      const getActualProduction = (gen) => {
        if (!gen || !gen.milestones) return gen.production || 0;
        
        let production = gen.production || 0;
        
        gen.milestones.forEach(milestone => {
          if (gen.owned >= milestone.amount) {
            production *= milestone.multiplier;
          }
        });
        
        return production;
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 text-white p-4">
          {showAchievement && (
            <div className="fixed top-4 right-4 bg-gradient-to-r from-yellow-400 to-orange-500 text-black px-6 py-4 rounded-lg shadow-2xl animate-bounce z-50">
              <div className="font-bold text-lg">üèÜ Achievement Unlocked!</div>
              <div className="text-sm">{showAchievement.name}</div>
              {showAchievement.reward && (
                <div className="text-xs mt-1">
                  Reward: {showAchievement.reward.type === 'clickMultiplier' ? 
                    `+${((showAchievement.reward.value - 1) * 100).toFixed(0)}% click power` :
                    `+${((showAchievement.reward.value - 1) * 100).toFixed(0)}% production`
                  }
                </div>
              )}
            </div>
          )}

          <div className="max-w-6xl mx-auto">
            <h1 className="text-4xl font-bold text-center mb-2 flex items-center justify-center gap-2">
              ‚ö° Energy Clicker
            </h1>
            {prestigeLevel > 0 && (
              <p className="text-center text-yellow-300 mb-2">
                ‚≠ê Prestige Level {prestigeLevel} | +{((prestigeBonus - 1) * 100).toFixed(0)}% bonus | üíé {prestigePoints} PP
              </p>
            )}
            <p className="text-center text-blue-200 mb-6">Klik om energie te verzamelen!</p>

            <div className="bg-white/10 backdrop-blur rounded-lg p-6 mb-6">
              <div className="text-center">
                <div className="text-5xl font-bold text-yellow-400 mb-2">
                  {Math.floor(energy).toLocaleString()} ‚ö°
                </div>
                <div className="text-xl text-blue-200">
                  {energyPerSecond > 0 && `+${energyPerSecond.toLocaleString()}/sec`}
                </div>
                <div className="text-sm text-gray-300 mt-2">
                  Click power: {Math.floor(clickPower * achievementClickBonus * prestigeBonus * prestigeClickBonus).toLocaleString()} | 
                  Total clicks: {totalClicks.toLocaleString()}
                  {autoClickRate > 0 && ` | ü§ñ Auto: ${autoClickRate}/sec`}
                </div>
                <div className="text-xs text-gray-400 mt-1">
                  Total earned: {Math.floor(totalEnergy).toLocaleString()} | 
                  Lifetime clicks: {lifetimeClicks.toLocaleString()} |
                  Achievement bonus: {((achievementProductionBonus - 1) * 100).toFixed(0)}% prod, {((achievementClickBonus - 1) * 100).toFixed(0)}% click
                  {prestigeLevel > 0 && ` | Prestige: +${((prestigeBonus - 1) * 100).toFixed(0)}%`}
                  {(prestigeClickBonus > 1 || prestigeProductionBonus > 1) && ` | PP Bonus: ${((prestigeClickBonus - 1) * 100).toFixed(0)}% click, ${((prestigeProductionBonus - 1) * 100).toFixed(0)}% prod`}
                </div>
              </div>
            </div>

            <div className="flex justify-center mb-6">
              <button
                onClick={handleClick}
                className="w-48 h-48 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full shadow-2xl transform transition hover:scale-105 active:scale-95 flex items-center justify-center text-6xl font-bold cursor-pointer"
              >
                ‚ö°
              </button>
            </div>

            {/* Tab Navigation */}
            <div className="flex flex-wrap justify-center gap-2 mb-6">
              <button
                onClick={() => setActiveTab('main')}
                className={`px-4 py-2 rounded-lg font-bold transition text-sm sm:text-base ${activeTab === 'main' ? 'bg-blue-500' : 'bg-gray-700 hover:bg-gray-600'}`}
              >
                ‚ö° Main
              </button>
              <button
                onClick={() => setActiveTab('upgrades')}
                className={`px-4 py-2 rounded-lg font-bold transition text-sm sm:text-base ${activeTab === 'upgrades' ? 'bg-purple-500' : 'bg-gray-700 hover:bg-gray-600'}`}
              >
                ‚≠ê Upgrades
              </button>
              <button
                onClick={() => setActiveTab('achievements')}
                className={`px-4 py-2 rounded-lg font-bold transition text-sm sm:text-base ${activeTab === 'achievements' ? 'bg-yellow-500' : 'bg-gray-700 hover:bg-gray-600'}`}
              >
                üèÜ Achievements
              </button>
              {prestigeLevel > 0 && (
                <button
                  onClick={() => setActiveTab('prestige')}
                  className={`px-4 py-2 rounded-lg font-bold transition text-sm sm:text-base ${activeTab === 'prestige' ? 'bg-pink-500' : 'bg-gray-700 hover:bg-gray-600'}`}
                >
                  üíé Prestige
                </button>
              )}
            </div>

            <div className="bg-white/10 backdrop-blur rounded-lg p-6 mb-6">
              <div className="text-center">
                <div className="text-5xl font-bold text-yellow-400 mb-2">
                  {Math.floor(energy).toLocaleString()} ‚ö°
                </div>
                <div className="text-xl text-blue-200">
                  {energyPerSecond > 0 && `+${energyPerSecond.toLocaleString()}/sec`}
                </div>
                <div className="text-sm text-gray-300 mt-2">
                  Click power: {Math.floor(clickPower * achievementClickBonus * prestigeBonus * prestigeClickBonus).toLocaleString()} | 
                  Total clicks: {totalClicks.toLocaleString()}
                  {autoClickRate > 0 && ` | ü§ñ Auto: ${autoClickRate}/sec`}
                </div>
                <div className="text-xs text-gray-400 mt-1">
                  Total earned: {Math.floor(totalEnergy).toLocaleString()} | 
                  Achievement bonus: {((achievementProductionBonus - 1) * 100).toFixed(0)}% prod, {((achievementClickBonus - 1) * 100).toFixed(0)}% click
                  {prestigeLevel > 0 && ` | Prestige: +${((prestigeBonus - 1) * 100).toFixed(0)}%`}
                  {(prestigeClickBonus > 1 || prestigeProductionBonus > 1) && ` | PP Bonus: ${((prestigeClickBonus - 1) * 100).toFixed(0)}% click, ${((prestigeProductionBonus - 1) * 100).toFixed(0)}% prod`}
                </div>
              </div>
            </div>

            {/* MAIN TAB */}
            {activeTab === 'main' && (
              <>
                {/* Autobuyers Toggle */}
                {(autoBuyersUnlocked.generators || autoBuyersUnlocked.upgrades) && (
                  <div className="bg-green-500/20 rounded-lg p-4 mb-6">
                    <h3 className="font-bold mb-2">ü§ñ Autobuyers</h3>
                    <div className="flex flex-wrap gap-3">
                      {autoBuyersUnlocked.generators && (
                        <button
                          onClick={() => setAutoBuyersEnabled(prev => ({ ...prev, generators: !prev.generators }))}
                          className={`px-4 py-2 rounded font-bold transition ${autoBuyersEnabled.generators ? 'bg-green-500' : 'bg-gray-700'}`}
                        >
                          Generators: {autoBuyersEnabled.generators ? 'ON' : 'OFF'}
                        </button>
                      )}
                      {autoBuyersUnlocked.upgrades && (
                        <button
                          onClick={() => setAutoBuyersEnabled(prev => ({ ...prev, upgrades: !prev.upgrades }))}
                          className={`px-4 py-2 rounded font-bold transition ${autoBuyersEnabled.upgrades ? 'bg-green-500' : 'bg-gray-700'}`}
                        >
                          Upgrades: {autoBuyersEnabled.upgrades ? 'ON' : 'OFF'}
                        </button>
                      )}
                    </div>
                  </div>
                )}

                <div className="bg-white/10 backdrop-blur rounded-lg p-6">
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-2xl font-bold">üìà Generators</h2>
                    <div className="flex gap-2">
                      <button
                        onClick={() => setBuyAmount(1)}
                        className={`px-3 py-1 rounded font-bold text-sm cursor-pointer ${buyAmount === 1 ? 'bg-blue-500' : 'bg-gray-700'}`}
                      >
                        x1
                      </button>
                      <button
                        onClick={() => setBuyAmount(10)}
                        className={`px-3 py-1 rounded font-bold text-sm cursor-pointer ${buyAmount === 10 ? 'bg-blue-500' : 'bg-gray-700'}`}
                      >
                        x10
                      </button>
                      <button
                        onClick={() => setBuyAmount('max')}
                        className={`px-3 py-1 rounded font-bold text-sm cursor-pointer ${buyAmount === 'max' ? 'bg-blue-500' : 'bg-gray-700'}`}
                      >
                        MAX
                      </button>
                      <button
                        onClick={() => setBuyAmount('milestone')}
                        className={`px-3 py-1 rounded font-bold text-sm cursor-pointer ${buyAmount === 'milestone' ? 'bg-blue-500' : 'bg-gray-700'}`}
                      >
                        ‚ûúMS
                      </button>
                    </div>
                  </div>
                  <div className="space-y-3">
                    {generators && generators.filter(g => g && g.visible).map(gen => {
                      const milestone = getMilestoneProgress(gen);
                      let amount;
                      if (buyAmount === 'max') {
                        amount = getMaxAffordable(gen);
                      } else if (buyAmount === 'milestone') {
                        amount = getToNextMilestone(gen);
                      } else {
                        amount = buyAmount;
                      }
                      const cost = calculateCost(gen, amount);
                      const actualProduction = getActualProduction(gen);
                      const totalProduction = actualProduction * gen.owned * achievementProductionBonus * prestigeBonus * prestigeProductionBonus;
                      
                      return (
                        <div key={gen.id} className="bg-black/20 rounded-lg p-4">
                          <div className="flex justify-between items-start mb-2">
                            <div className="flex-1">
                              <div className="font-bold">{gen.name}</div>
                              <div className="text-sm text-gray-300">
                                Base: {gen.production}/sec | With bonuses: {actualProduction.toFixed(1)}/sec
                              </div>
                              <div className="text-sm text-blue-300">
                                Owned: {gen.owned} | Total: {totalProduction.toFixed(1)}/sec
                              </div>
                              {milestone && (
                                <div className="text-xs text-yellow-300 mt-1">
                                  Next milestone: {milestone.current}/{milestone.next} (+{gen.milestones.find(m => m.amount === milestone.next).multiplier}x)
                                </div>
                              )}
                            </div>
                            <button
                              onClick={() => buyGenerator(gen)}
                              disabled={energy < cost || amount === 0}
                              className={`px-4 py-2 rounded font-bold transition cursor-pointer ${
                                energy >= cost && amount > 0
                                  ? 'bg-green-500 hover:bg-green-600'
                                  : 'bg-gray-600 cursor-not-allowed opacity-50'
                              }`}
                            >
                              {amount > 1 ? `${amount}x ` : ''}{cost.toLocaleString()} ‚ö°
                            </button>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>

                {canPrestige && (
                  <div className="mt-6 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg p-6">
                    <h2 className="text-2xl font-bold mb-2">üèÜ Prestige Available!</h2>
                    <p className="text-sm mb-4">
                      Reset alles voor +50% permanent bonus √©n {calculatePrestigePoints()} Prestige Points!
                      <br/>
                      <span className="text-xs">Volgende prestige kost: {(getPrestigeCost() * 2).toLocaleString()} total energy</span>
                    </p>
                    <button
                      onClick={doPrestige}
                      className="w-full px-4 py-3 bg-yellow-400 hover:bg-yellow-500 text-black rounded font-bold transition cursor-pointer"
                    >
                      PRESTIGE NOW
                    </button>
                  </div>
                )}
              </>
            )}

            {/* UPGRADES TAB */}
            {activeTab === 'upgrades' && (
              <div className="bg-white/10 backdrop-blur rounded-lg p-6">
                <h2 className="text-2xl font-bold mb-4 flex items-center gap-2">
                  ‚≠ê Upgrades
                </h2>
                <div className="grid md:grid-cols-2 gap-3">
                  {upgrades && upgrades.filter(u => u && u.visible).map(upgrade => (
                    <div key={upgrade.id} className="bg-black/20 rounded-lg p-4">
                      <div className="flex justify-between items-start mb-2">
                        <div className="flex-1">
                          <div className="font-bold">{upgrade.name}</div>
                          <div className="text-sm text-gray-300">
                            {upgrade.purchased ? '‚úì Gekocht!' : `${upgrade.multiplier}x ${upgrade.type === 'click' ? 'clicks' : 'production'}`}
                          </div>
                        </div>
                        {!upgrade.purchased && (
                          <button
                            onClick={() => buyUpgrade(upgrade)}
                            disabled={energy < upgrade.cost}
                            className={`px-4 py-2 rounded font-bold transition cursor-pointer ${
                              energy >= upgrade.cost
                                ? 'bg-purple-500 hover:bg-purple-600'
                                : 'bg-gray-600 cursor-not-allowed opacity-50'
                            }`}
                          >
                            {upgrade.cost.toLocaleString()} ‚ö°
                          </button>
                        )}
                        {upgrade.purchased && (
                          <div className="text-green-400 font-bold text-2xl">‚úì</div>
                        )}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* ACHIEVEMENTS TAB */}
            {activeTab === 'achievements' && (
              <div className="bg-white/10 backdrop-blur rounded-lg p-6">
                <h2 className="text-2xl font-bold mb-4">üèÜ Achievements</h2>
                <div className="grid md:grid-cols-2 gap-3">
                  {achievements && achievements.map(ach => (
                    <div 
                      key={ach.id} 
                      className={`p-4 rounded-lg ${ach.unlocked ? 'bg-yellow-500/30' : 'bg-black/20'}`}
                    >
                      <div className="flex items-start gap-3">
                        <span className="text-4xl">{ach.unlocked ? 'üèÜ' : 'üîí'}</span>
                        <div className="flex-1">
                          <div className="font-bold text-lg">{ach.name}</div>
                          <div className="text-sm text-gray-300">{ach.desc}</div>
                          {ach.unlocked && ach.reward && (
                            <div className="text-sm text-yellow-300 mt-2 font-bold">
                              Reward: {
                                ach.reward.type === 'clickMultiplier' ? `+${((ach.reward.value - 1) * 100).toFixed(0)}% click power` :
                                ach.reward.type === 'productionMultiplier' ? `+${((ach.reward.value - 1) * 100).toFixed(0)}% production` :
                                ach.reward.type === 'unlockAutobuyers' ? `Unlock ${ach.reward.value} autobuyer!` : ''
                              }
                            </div>
                          )}
                          {!ach.unlocked && (
                            <div className="text-xs text-gray-400 mt-1">
                              Progress: {ach.type === 'clicks' ? lifetimeClicks : Math.floor(totalEnergy)}/{ach.requirement}
                            </div>
                          )}
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* PRESTIGE TAB */}
            {activeTab === 'prestige' && (
              <div className="space-y-6">
                <div className="bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg p-6">
                  <h2 className="text-3xl font-bold mb-2">üíé Prestige Shop</h2>
                  <p className="text-lg mb-4">Available Points: {prestigePoints} PP</p>
                  <div className="text-sm bg-black/20 rounded p-3">
                    <strong>Info:</strong> Prestige Points verdien je bij elke prestige. Formula: ‚àö(totalEnergy/1M)
                    <br/>Bij 1M = 1 PP, bij 4M = 2 PP, bij 9M = 3 PP, etc.
                  </div>
                </div>

                <div className="bg-white/10 backdrop-blur rounded-lg p-6">
                  <h3 className="text-xl font-bold mb-4">Permanent Upgrades</h3>
                  <div className="grid md:grid-cols-2 gap-3">
                    {prestigeUpgrades && prestigeUpgrades.map(upgrade => (
                      <div key={upgrade.id} className="bg-black/20 rounded-lg p-4">
                        <div className="flex justify-between items-start">
                          <div className="flex-1">
                            <div className="font-bold text-lg">{upgrade.name}</div>
                            <div className="text-sm text-gray-300">
                              {upgrade.purchased ? '‚úì Gekocht!' : 
                                upgrade.effect.type === 'clickMultiplier' ? `${upgrade.effect.value}x click power` :
                                upgrade.effect.type === 'productionMultiplier' ? `${upgrade.effect.value}x production` :
                                upgrade.effect.type === 'offlineRate' ? `${(upgrade.effect.value * 100).toFixed(0)}% offline production` :
                                upgrade.effect.type === 'autoClick' ? `${upgrade.effect.value} auto-clicks/sec` : ''
                              }
                            </div>
                          </div>
                          {!upgrade.purchased && (
                            <button
                              onClick={() => buyPrestigeUpgrade(upgrade)}
                              disabled={prestigePoints < upgrade.cost}
                              className={`px-4 py-2 rounded font-bold transition cursor-pointer ${
                                prestigePoints >= upgrade.cost
                                  ? 'bg-pink-500 hover:bg-pink-600'
                                  : 'bg-gray-600 cursor-not-allowed opacity-50'
                              }`}
                            >
                              {upgrade.cost} PP
                            </button>
                          )}
                          {upgrade.purchased && (
                            <div className="text-green-400 font-bold text-2xl">‚úì</div>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            )}

            <div className="mt-6 bg-blue-500/20 rounded-lg p-4 text-sm">
              <strong>üí° Tips:</strong> Milestone bonussen bij 10/25/50! Koop meerdere generators tegelijk met x10 of MAX. Prestige bij 1M total energy!
              <button 
                onClick={resetGame}
                className="ml-4 px-3 py-1 bg-red-500 hover:bg-red-600 rounded text-xs font-bold cursor-pointer"
              >
                Reset Game
              </button>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<EnergyClicker />, document.getElementById('root'));
  </script>
</body>
</html>